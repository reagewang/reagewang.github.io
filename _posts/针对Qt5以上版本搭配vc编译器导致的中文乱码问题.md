# 针对Qt5以上版本搭配vc编译器导致的中文乱码问题

首先，要先了解下面两个概念：
source-charset：源码字符集，即我们的源代码文件使用的编码
execution-charset：执行字符集，编译器存储字面字符串时使用的编码

既然Qt5开始，QString默认把字面字符串当utf-8编码进行转换，那么我们的源码字符集，即源文件最好也保持一致，使用utf-8编码。这里值得注意的是，utf-8编码的文件可以带bom头也可以不带bom头，但是由于vc处理源码的时候，只有带bom头的文件才会被正确当作utf-8编码的文件看待，而无bom头则认为是本地默认编码。所以我们的源码文件必需统一使用带bom头的utf-8格式，这里QtCreator提供对应的设置让我们在生成源码文件的时候会使用这种格式。

接下来，就是要处理执行字符集的问题，我们需要把vc的执行字符集也设置为utf-8，这样所有的字面字符串保存的编码都会是utf-8，就可以和QString无缝结合了。
vc2013的设置方法是通过预处理命令
```
#pragma execution_character_set("utf-8")
```
vc2015之后，上述的预处理命令的方式过时了，微软建议编码器的编译参数中使用/utf-8来完成设置
```
msvc {
    QMAKE_CFLAGS += /utf-8
    QMAKE_CXXFLAGS += /utf-8
}
```