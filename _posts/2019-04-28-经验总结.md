---
layout: post
title: "经验总结"
tags: [build, debug]
comments: true
---

经验总结

# 编译通过但打包时提示png图片资源错误
```
FAILURE: Build failed with an exception.
 
What went wrong:
Execution failed for task ':app:mergeReleaseResources'.
java.util.concurrent.ExecutionException: com.android.builder.internal.aapt.v2.Aapt2Exception: Android resource compilation failed
Output:  D:\Gitee\sun\Launcher\app\src\main\res\mipmap-mdpi\tech_ac_statusbar_air_seat_ventilation_left_off.png: error: failed to read PNG signature: file does not start with PNG signature.

原因是图片后缀虽然是png但是图片本身资源不是
```

# 在build lib中的class文件时，没找到其中一个jar文件，这个文件不存在。
```
Error:FAILURE: Build failed with an exception.

* What went wrong:
Could not resolve all files for configuration ':app:debugCompileClasspath'.
> Failed to transform file 'CommonTools.jar' to match attributes {artifactType=processed-jar} using transform IdentityTransform
   > Transform output file D:\Gitee\sun\Launcher\app\libs\CommonTools.jar does not exist.

* Try:
Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.

* Get more help at https://help.gradle.org

BUILD FAILED in 2s

看了下各个libs下的文件，发现确实没有。但是以往build的时候，并没有出现上述问题。仔细想了想，以前build没有出现这个问题，说明这个jar在项目中没有被用到，因为如果有用到，而jar包又确实不存在，肯定会build失败。所以，就想把该jar注释掉试试看build会如何

重新build后，可以build成功

回顾以前，想起来，当初项目用到的一个功能，需要使用第三方的lib，所以使用了上面的jar。 后来，项目中又用到另一个功能，需要使用同一个服务商的另一个lib，这个lib包含了上面lib的功能，所以把原来的删除掉，但是compile files这块还存在没有去掉

结论：新的版本as，至少3.0.1，增加了对编译时使用lib的校验，如果没有找到相应的jar，就会报错。
```

# c++编译错误：invalid new-expression of abstract class type
```
出现这个错误原因是new 了一个抽象类出错，说明父类（接口）中有纯虚函数没有实现。接口里的纯虚函数全部需要实现，这样才能new 子类。
```

# Ubuntu下run格式双击无效
```
要先右键--权限--允许以程序运行
```

# Qt setGeometry时没有移动到指定的位置原因
```
QWindow变更大小时需要reSize重置窗口的大小
```

# Qt Creator 编译警告
```
QML Settings: Failed to initialize QSettings instance. Status code is: 1
QML Settings: The following application identifiers have not been set: QVector("organizationName", "organizationDomain")

解决方法
在main.cpp文件里添加

app.setOrganizationName("Some Company");
app.setOrganizationDomain("somecompany.com");
app.setApplicationName("Amazing Application");
```

# This Template did not Produce a Java Class or an interface
```
找到Android Studio安装目录下的Studio.exe.vmoptions，如果是64位的，就用记事本打开64的这个文件。在末尾添加`-Djdk.util.zip.ensureTrailingSlash=false`保存。重启Android Studio就可以了
```

# Android P 运行JobService时提示 No such service class
```java
// jobId需要唯一
JobInfo.Builder builder = new JobInfo.Builder(jobId, new ComponentName(包名, 类名);
```

# Android studio 编译错误
```
Error:FAILURE: Build failed with an exception.

* What went wrong:
Execution failed for task ':app:preDebugAndroidTestBuild'.
> Conflict with dependency 'com.android.support:support-annotations' in project ':app'. Resolved versions for app (25.3.1) and test app (27.1.1) differ. See https://d.android.com/r/tools/test-apk-dependency-conflicts.html for details.

* Try:
Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.

* Get more help at https://help.gradle.org

BUILD FAILED in 7s

解决方法 1
于 app 的 build.gradle 中， 在 android{...} 里添加如下代码：
configurations.all {
        resolutionStrategy.force 'com.android.support:support-annotations:27.1.1'
    }
同步 build.gradle 文件

解决方法 2
于 app 的 build.gradle 中， 在 android{...} 里，更改一下属性，使其为最近版本号，如下
andorid{
    ...
    defaultConfig {
     compileSdkVersion 27
        defaultConfig {
            ...
            targetSdkVersion 27
            ...
        }
        ...
    }
    ...
}

经验总结:
看报错信息 '.Conflict with dependency 'com.android.support:support-annotations' 说明是依赖冲突，Resolved versions for app (26.1.0) and test app (27.1.1) differ 给出了冲突的版本，之后要么把冲突的地方降级为 (26.1.0)，要么把整个升级为版本 27
```

# Qt加载PNG图片警告
```
libpng warning: iCCP: cHRM chunk does not match sRGB
libpng warning: iCCP: known incorrect sRGB profile
```
```
把要加载的图片用PS中去掉png图像的icc配置文件就可以了
或者用QImage重新加载另存为PNG也可以
```

# 错误 signal 6 - SIGABRT
``` 
free 多次
fclose 多次
```
# 错误 signal 11 - SIGSEGV
```
引用空指针成员
fclose 空指针
```

# qlabel加载图片时图片会造成qlabel的大小产生变化
需要设置setSizePolicy

# linux下双击qt程序无法运行
qt在linux下编译出来的应用程序需要在pro增加QMAKE_LFLAGS += -no-pie，不然双击无法运行

# qsocketnotifier socket notifiers cannot be enabled or disabled from another thread
把udpsocket放到线程里面进行数据处理，udpsocket构造的时候需要指定父类对象this，如m_pUdpSocket = new QUdpSocket(this);不然与UI进行数据信号传递时会报"qsocketnotifier socket notifiers cannot be enabled or disabled from another thread"错误

# QML中绘制动态图像可以采用两种方式
a.在QML中加入Image组件然后给source属性赋值Image地址，此地址由继承QQuickImageProvider的类接口提供，在加载url之前添加继承QQuickImageProvider的类。
形式如下：
QQmlApplicationEngine engine;
engine.addImageProvider(QLatin1String("目录名"), 继承QQuickImageProvider的类对象);
source地址如下：
Image.cache: false
Image.source："image://目录名/id名"

b.继承QQuickPaintedItem
注册该类，qmlRegisterType<继承QQuickPaintedItem的类名>("包名", 1, 0, "在QML中用来表示继承QQuickPaintedItem的类的名字");
实现paint接口，把对图像的绘制放置到paint接口里面实现，类似于QtWidget模式下的painterEvent接口一样。
继承QQuickPaintedItem的类在注册的时候就已经实例化好了，不能把该类放置到另外的类里面做成员变量，不然paint无法被调用

# 回调函数内访问类成员函数
申明静态类指针，指针初始化，类构造时赋值this给静态类指针，即可在回调函数内引用类指针访问类成员函数或成员对象

# QML中Text旋转了之后进行对齐的问题

# 执行./configure报错
1. arm-hisiv400-linux-g++: not found 是因为环境问题
* 查看编译器版本命令“arm-hisiv400-linux-g++ -v”
* 结果：bash: /opt/hisi-linux/x86-arm/arm-hisiv400-linux-g++/target/bin/arm-hisiv400-linux-g++: No such file or directory 说明：gcc编译器找不到，但是编译器确实是安装完成了，输入arm，按两次Tab后也能找到交叉编译gcc文件

2. 交叉编译器虽然安装了，但是交叉编译器的运行缺少库文件，这是因为宿主机是64 位 而交叉编译器是针对32位的开发板制作的。所以要安装对应的32位库。我的linux宿主机是ubuntu 16.04 64位。安装命令：
```
sudo apt install lib32z1-dev
```

3. 安装完成后，再执行“arm-hisiv400-linux-g++ -v”，即可出现gcc的版本信息，表示gcc安装成功。