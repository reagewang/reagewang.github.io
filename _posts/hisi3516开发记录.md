# hisi3516开发记录

## 修改ip地址
vi /userdata/user.conf

```
# network config
RUN_TELNETD=yes                         # run telnetd after system run default:yes
ETH0_CFG=static                         # static or dhcp
BOARD_IP=192.168.102.60
NETMASK=255.255.0.0
BROADCAST=192.168.255.255
```

## 修改telnet密码
passwd root

```
~ # passwd root
Changing password for root
New password:
Bad password: too weak
Retype password:
passwd: password for root changed by root
~ # exit
```

## mount虚拟机目录
mkdir /root/nfsdir
### 添加mount指令到/etc/init.d/rcS
mount -t nfs -o nolock 192.168.102.58:/home/wh/nfsdir  /root/nfsdir

## 拷贝qt5.12.9环境到mount目录
```
cp -a /opt/qt5.12.9_hi3516dv300/lib/ /opt/qt5.12.9_hi3516dv300/plugins/ /opt/qt5.12.9_hi3516dv300/qml/ ~/nfsdir/qt5129/

cp -a /root/nfsdir/qt5129/ /usr/qt5129/
```

## 创建启动应用脚本
```
export QTDIR=/usr/qt5129
export QML2_IMPORT_PATH=$QTDIR/qml
export QT_QPA_FONTDIR=$QTDIR/lib/fonts
export LD_LIBRARY_PATH=$QTDIR/lib:$LD_LIBRARY_PATH
export QT_QPA_PLATFORM_PLUGIN_PATH=$QTDIR/plugins
export QT_QPA_PLATFORM=linuxfb:fb=/dev/fb0
export QT_QPA_GENERIC_PLUGINS=evdevmouse:/dev/input/event0,evdevkeyboard:/dev/input/event1

./QtVirtualKeyboardDemo &
```

## qml中增加自定义字体
```
FontLoader {
    id: customFont;
    source: "qrc:/res/alifree.ttf"
}

Text {
    font.family: customFont.name
}
```

## 调试时清理fb
dd if=/dev/zero of=/dev/fb0


## 屏幕旋转问题汇总
### 采用QGraphicsView方式
```c++
QGraphicsScene *scene = new QGraphicsScene;
QGraphicsProxyWidget *proxyWidget = scene->addWidget(&w);
proxyWidget->setRotation(90);
qDebug() << "rotation 90";
QGraphicsView *view = new QGraphicsView(scene);
view->setWindowFlag(Qt::FramelessWindowHint);
view->centerOn(0, 0);
view->resize(currentScreenHeight, currentScreenWidth);
view->setVerticalScrollBarPolicy(Qt::ScrollBarAlwaysOff);
view->setHorizontalScrollBarPolicy(Qt::ScrollBarAlwaysOff);
view->show();
```
此方法缺陷
如果采用全屏虚拟键盘，键盘仍然是旋转之前的方向。
如果采用嵌入式虚拟键盘，则无法获取焦点事件。

### 修改Qt源码linuxfb部分代码实现旋转 qt-everywhere-src-5.12.9/qtbase/src/plugins/platforms/linuxfb/
```cpp
class QLinuxFbScreen : public QFbScreen
{
    Q_OBJECT
public:
    QLinuxFbScreen(const QStringList &args);
    ~QLinuxFbScreen();
 
    bool initialize();
 
    QPixmap grabWindow(WId wid, int x, int y, int width, int height) const Q_DECL_OVERRIDE;
 
    QRegion doRedraw() Q_DECL_OVERRIDE;
 
private:
    QStringList mArgs;
    int mFbFd;
    int mTtyFd;
	
	// add by immortal start
	int mRotation;
	// add by immortal end
	
    QImage mFbScreenImage;
    int mBytesPerLine;
    int mOldTtyMode;
 
    struct {
        uchar *data;
        int offset, size;
    } mMmap;
 
    QPainter *mBlitter;
};
```

```cpp
QLinuxFbScreen::QLinuxFbScreen(const QStringList &args)
 //   : mArgs(args), mFbFd(-1), mTtyFd(-1), mBlitter(0)  // modify by immortal
 : mArgs(args), mFbFd(-1), mTtyFd(-1), mBlitter(0),mRotation(0)
{
    mMmap.data = 0;
}
 
QLinuxFbScreen::~QLinuxFbScreen()
{
    if (mFbFd != -1) {
        if (mMmap.data)
            munmap(mMmap.data - mMmap.offset, mMmap.size);
        close(mFbFd);
    }
 
    if (mTtyFd != -1)
        resetTty(mTtyFd, mOldTtyMode);
 
    delete mBlitter;
}
 
bool QLinuxFbScreen::initialize()
{
    QRegularExpression ttyRx(QLatin1String("tty=(.*)"));
    QRegularExpression fbRx(QLatin1String("fb=(.*)"));
    QRegularExpression mmSizeRx(QLatin1String("mmsize=(\\d+)x(\\d+)"));
    QRegularExpression sizeRx(QLatin1String("size=(\\d+)x(\\d+)"));
    QRegularExpression offsetRx(QLatin1String("offset=(\\d+)x(\\d+)"));
	
	// add by immorta start
	QRegularExpression rotationRx(QLatin1String("rotation=(0|90|180|270)"));
	// add by immorta end
 
    QString fbDevice, ttyDevice;
    QSize userMmSize;
    QRect userGeometry;
    bool doSwitchToGraphicsMode = true;
 
    // Parse arguments
    foreach (const QString &arg, mArgs) {
        QRegularExpressionMatch match;
        if (arg == QLatin1String("nographicsmodeswitch"))
            doSwitchToGraphicsMode = false;
        else if (arg.contains(mmSizeRx, &match))
            userMmSize = QSize(match.captured(1).toInt(), match.captured(2).toInt());
        else if (arg.contains(sizeRx, &match))
            userGeometry.setSize(QSize(match.captured(1).toInt(), match.captured(2).toInt()));
        else if (arg.contains(offsetRx, &match))
            userGeometry.setTopLeft(QPoint(match.captured(1).toInt(), match.captured(2).toInt()));
        else if (arg.contains(ttyRx, &match))
            ttyDevice = match.captured(1);
        else if (arg.contains(fbRx, &match))
            fbDevice = match.captured(1);
		// add by immortal start
		else if (arg.contains(rotationRx, &match))
			mRotation = match.captured(1).toInt();
		// add by immortal end
    }
 
    if (fbDevice.isEmpty()) {
        fbDevice = QLatin1String("/dev/fb0");
        if (!QFile::exists(fbDevice))
            fbDevice = QLatin1String("/dev/graphics/fb0");
        if (!QFile::exists(fbDevice)) {
            qWarning("Unable to figure out framebuffer device. Specify it manually.");
            return false;
        }
    }
 
    // Open the device
    mFbFd = openFramebufferDevice(fbDevice);
    if (mFbFd == -1) {
        qErrnoWarning(errno, "Failed to open framebuffer %s", qPrintable(fbDevice));
        return false;
    }
 
    // Read the fixed and variable screen information
    fb_fix_screeninfo finfo;
    fb_var_screeninfo vinfo;
    memset(&vinfo, 0, sizeof(vinfo));
    memset(&finfo, 0, sizeof(finfo));
 
    if (ioctl(mFbFd, FBIOGET_FSCREENINFO, &finfo) != 0) {
        qErrnoWarning(errno, "Error reading fixed information");
        return false;
    }
 
    if (ioctl(mFbFd, FBIOGET_VSCREENINFO, &vinfo)) {
        qErrnoWarning(errno, "Error reading variable information");
        return false;
    }
 
    mDepth = determineDepth(vinfo);
    mBytesPerLine = finfo.line_length;
    QRect geometry = determineGeometry(vinfo, userGeometry);
	// add by immortal start
	QRect originalGeometry = geometry;
	if( 90 == mRotation  || 270 == mRotation )
    {
		int tmp = geometry.width();
        geometry.setWidth(geometry.height());
        geometry.setHeight(tmp);
    }
	// add by immortal end
    mGeometry = QRect(QPoint(0, 0), geometry.size());
    mFormat = determineFormat(vinfo, mDepth);
	
	// modify by immortal start
	//   mPhysicalSize = determinePhysicalSize(vinfo, userMmSize, geometry.size());
	mPhysicalSize = determinePhysicalSize(vinfo, userMmSize, originalGeometry.size());
	// modify by immortal end
	
    // mmap the framebuffer
    mMmap.size = finfo.smem_len;
    uchar *data = (unsigned char *)mmap(0, mMmap.size, PROT_READ | PROT_WRITE, MAP_SHARED, mFbFd, 0);
    if ((long)data == -1) {
        qErrnoWarning(errno, "Failed to mmap framebuffer");
        return false;
    }
	// modify by immortal start
//   mMmap.offset = geometry.y() * mBytesPerLine + geometry.x() * mDepth / 8;
	mMmap.offset = originalGeometry.y() * mBytesPerLine + originalGeometry.x() * mDepth / 8;
	// modify by immortal end
	
    mMmap.data = data + mMmap.offset;
 
    QFbScreen::initializeCompositor();
	
    // modify by immortal start
	// mFbScreenImage = QImage(mMmap.data, geometry.width(), geometry.height(), mBytesPerLine, mFormat);
	mFbScreenImage = QImage(mMmap.data, originalGeometry.width(), originalGeometry.height(), mBytesPerLine, mFormat);
	// modify by immortal end
	
    mCursor = new QFbCursor(this);
 
    mTtyFd = openTtyDevice(ttyDevice);
    if (mTtyFd == -1)
        qErrnoWarning(errno, "Failed to open tty");
 
    switchToGraphicsMode(mTtyFd, doSwitchToGraphicsMode, &mOldTtyMode);
    blankScreen(mFbFd, false);
 
    return true;
}
 
QRegion QLinuxFbScreen::doRedraw()
{
    QRegion touched = QFbScreen::doRedraw();
 
    if (touched.isEmpty())
        return touched;
 
    if (!mBlitter)
        mBlitter = new QPainter(&mFbScreenImage);
 
    mBlitter->setCompositionMode(QPainter::CompositionMode_Source);
    for (const QRect &rect : touched)
    {
        //@ add for rotation start
        if(90 == mRotation || 270 == mRotation)
        {
            mBlitter->translate(mGeometry.height()/2,mGeometry.width()/2);
        }
        else if(180 == mRotation)
        {
            mBlitter->translate(mGeometry.width()/2,mGeometry.height()/2);
        }
        if(mRotation != 0)
        {
            mBlitter->rotate(mRotation);
            mBlitter->translate(-mGeometry.width()/2, -mGeometry.height()/2);
        }
        //@ add for rotation end

        mBlitter->drawImage(rect, mScreenImage, rect);

        //@ add for rotation start
        mBlitter->resetTransform();
        //@ add for rotation end

    }

    return touched;
}
 
// grabWindow() grabs "from the screen" not from the backingstores.
// In linuxfb's case it will also include the mouse cursor.
QPixmap QLinuxFbScreen::grabWindow(WId wid, int x, int y, int width, int height) const
{
    if (!wid) {
        if (width < 0)
            width = mFbScreenImage.width() - x;
        if (height < 0)
            height = mFbScreenImage.height() - y;
        return QPixmap::fromImage(mFbScreenImage).copy(x, y, width, height);
    }
    QFbWindow *window = windowForId(wid);
    if (window) {
        const QRect geom = window->geometry();
        if (width < 0)
            width = geom.width() - x;
        if (height < 0)
            height = geom.height() - y;
        QRect rect(geom.topLeft() + QPoint(x, y), QSize(width, height));
        rect &= window->geometry();
        return QPixmap::fromImage(mFbScreenImage).copy(rect);
    }
    return QPixmap();
}
```

## 设置export QT_QPA_EVDEV_TOUCHSCREEN_PARAMETERS报错
Invalid ABS limits, behavior unspecified
原因:export QT_QPA_EVDEV_TOUCHSCREEN_PARAMETERS=/dev/input/event0:rotate=270
event0的设备节点错误，不是触摸设备节点

## 虚拟键盘问题
qt虚拟键盘打开，除去键盘外，背景全黑，并且提示：This plugin does not support setting window masks
原因：没有InputPanel节点。
解决方法：创建一个空白的带虚拟键盘的工程，从其中拷贝InputPanel节点并复制到对应QML文件中。

## QT5移植嵌入式触摸屏，点击位置和显示位置不对解决方法
排除触摸屏驱动和硬件问题
hexdump /dev/input/event2 查看触摸屏是否正常
设置环境变量
export QT_QPA_EVDEV_TOUCHSCREEN_PARAMETERS=/dev/input/event2/*触摸硬件节点*/:rotate=270/*旋转90 180 270*/:invertx/*是否镜像*/

## 修改Qt键盘指定切换语言,候选框常显
```c++
Component.onCompleted: {
    VirtualKeyboardSettings.activeLocales = ["en_GB","zh_CN"];
    VirtualKeyboardSettings.locale = "en_GB";
    VirtualKeyboardSettings.wordCandidateList.alwaysVisible = true;
}
```

## shm打开失败
执行 mkdir /dev/shm 指令

## 采用内嵌qml虚拟键盘问题
现象：如果两个qml都加载了InputPanel了，就会造成先加载的qml文件键盘无法有效输入。
解决方法：把需要输入的qml文件放在一个qml内。或者把采用先后动态加载的方式，用完即释放。

## 重写qt虚拟键盘，自定义布局，加入google拼音源码，以自定义插件的形式加入

## QComboBox控件问题
无论怎么调试qss样式，拥有控件时QComboBox始终是白色

## 动态添加QMenu到QPushButton上
qss定制QMenu的QMenu::separator样式必须addSeparator()

## 去掉qpushbutton上的小箭头
```
QPushButton::menu-indicator{
image:none;
}
```

## qss设置QTableView行高无效的问题
ui->tableView->verticalHeader()->setDefaultSectionSize(120);
ui->tableView->verticalHeader()->setMinimumSectionSize(120);

## QTableView根据内容自动调整列宽
ui->tableView->horizontalHeader()->setSectionResizeMode(QHeaderView::ResizeToContents);

## Qt使用QSettings读取配置文件中的中文乱码解决方案
一般情况都是系统编码与文件编码不一致造成
settings.setIniCodec(QTextCodec::codecForName("UTF-8"));
//设置文件的编码格式（如果INI文件编码为UTF-8则这里设置UTF-8，如果为GB2312，则这里设置GB2312，两者一致）,即可读写ini文件中的中文
如果key为中文，则采用QString::fromLocal8Bit("中文")进行处理

## 颜色rgb值
表格内分割线蓝色 
rgb(91, 143, 240)

表格选中行背景橙色 
rgb(235, 97, 0)

表头背景蓝色 
rgb(96, 148,  249)

窗体背景蓝色 
rgb(20, 73, 141)

表格背景透明
transparent

视频页右侧背景蓝色
rgb(26, 67, 131)

视频页右侧边框线
rgb(114, 155, 234)

登录按钮背景色
rgb(20, 147, 250)

## 修改mac地址
ifconfig eth0 down
ifconfig eth0 hw ether 4E:14:9F:45:03:D3
ifconfig eth0 up

## 配置网络地址
ifconfig eth0 192.168.102.60 netmask 255.255.0.0

## 挂载nfs文件系统
mount -t nfs -o nolock 192.168.102.58:/home/wh/nfsdir  /nfsroot
mount -t nfs -o nolock 192.168.102.128:/nfsroot/MobileBayonet /nfs2

## 查找依赖库文件
```sh
#! /bin/bash

function findobj(){
    for file in `ls $1`
    do
        #echo "file is ${file}"
        if [ -d $1"/"$file ]
        then
            findobj $1"/"$file $2
        else
            result=`readelf -s $1"/"$file 2>/dev/null | grep -q $2`
            if [ $? -eq 0 ]
            then
                echo $1"/"$file
            fi
        fi
    done
}

#findobj . "HI_MPI_HDMI_Start"
echo "param_1:$1, param_2:$2"
findobj $1 $2
```

## 启动后台应用脚本
```sh
kill -9 $(ps -ef | grep qtbg | grep -v grep | awk '{print $1}')

export QTDIR=/user/app/qt5129
export LD_LIBRARY_PATH=$QTDIR/lib:$LD_LIBRARY_PATH
export LD_LIBRARY_PATH=$QTDIR/../3516-lib:$LD_LIBRARY_PATH
export QT_QPA_PLATFORM_PLUGIN_PATH=$QTDIR/plugins

./qtbg &
```

## 启动UI应用脚本
```sh
#kill -9 $(ps -ef | grep qtdemo | grep -v grep | awk '{print $1}')

#dd if=/dev/zero of=/dev/fb0

export QTDIR=/user/app/qt5129
export LD_LIBRARY_PATH=$QTDIR/lib:$LD_LIBRARY_PATH
export LD_LIBRARY_PATH=$QTDIR/../3516-lib:$LD_LIBRARY_PATH
export QT_QPA_PLATFORM_PLUGIN_PATH=$QTDIR/plugins
#export QT_QPA_PLATFORM=linuxfb:fb=/dev/fb0:rotation=90
export QT_QPA_PLATFORM=linuxfb:fb=/dev/fb0
#export QT_QPA_GENERIC_PLUGINS=evdevmouse:/dev/input/event0,evdevkeyboard:/dev/input/event1
export QT_QPA_EVDEV_TOUCHSCREEN_PARAMETERS=/dev/input/event1
#export QT_QPA_EVDEV_TOUCHSCREEN_PARAMETERS=/dev/input/event1:rotate=270

./qtdemo &
```

```sh
export QTDIR=/opt/ipnc/app/qt_5129_3516_neon
#export QML2_IMPORT_PATH=$QTDIR/qml
export TSLIB_DIR=/opt/ipnc/app/tslib122

export TSLIB_TSDEVICE=/dev/input/event1
export TSLIB_CALIBFILE=$TSLIB_DIR/etc/pointercal
export TSLIB_CONFFILE=$TSLIB_DIR/etc/ts.conf
export TSLIB_PLUGINDIR=$TSLIB_DIR/lib/ts
export TSLIB_CONSOLEDEVICE=none
export TSLIB_FBDEVICE=/dev/fb0
export LD_LIBRARY_PATH=$QTDIR/lib:$QTDIR/../3516-lib:$TSLIB_DIR/lib:$LD_LIBRARY_PATH

export QT_QPA_FB_TSLIB=1
#export QT_QPA_FONTDIR=$QTDIR/lib/fonts
export QT_QPA_PLATFORM_PLUGIN_PATH=$QTDIR/plugins

export QT_QPA_PLATFORM=linuxfb:fb=/dev/fb0:rotation=90
#export QT_QPA_PLATFORM=linuxfb:fb=/dev/fb0:rotation=90:size=1920x1080:mmsize=1920x1080
#export QT_QPA_PLATFORM=linuxfb:fb=/dev/fb0:size=1920x1080:mmsize=1920x1080

#export QT_QPA_GENERIC_PLUGINS=evdevtouch:/dev/input/event1
#export QT_QPA_GENERIC_PLUGINS=evdevmouse:/dev/input/mouse0
#export QT_QPA_GENERIC_PLUGINS=evdevkeyboard:/dev/input/event2
#export QT_QPA_GENERIC_PLUGINS=evdevtouch:/dev/input/event0,evdevkeyboard:/dev/input/event1,evdevmouse:/dev/input/mouse0

# 指定输入设备的名称 rotate 旋转角度 invertx 翻转x轴 inverty 翻转y轴
#export QT_QPA_EVDEV_TOUCHSCREEN_PARAMETERS=/dev/input/event1:rotate=90
#export QT_QPA_EVDEV_TOUCHSCREEN_PARAMETERS=/dev/input/event1:rotate=90:invertx:inverty 

# 打印触屏信息
#export QT_LOGGING_RULES=qt.qpa.input=true 

# 调试信息
export QT_DEBUG_PLUGINS=1

# 将触摸屏的点击事件配置成Qt的鼠标点击事件
#export QT_QPA_EVDEV_MOUSE_PARAMETERS=/dev/input/event1

# 为1则隐藏鼠标光标，为0则显示鼠标光标
#export QT_QPA_FB_HIDECURSOR=1 

/opt/ipnc/app/qtdemo &
```

## TSLIB相关
tslib只支持单点触摸，多点触摸屏需要修改数据上报部分，所以建议电容屏就不使用tslib，免得麻烦，Qt5不在一定需要tslib。
对于 Qt 而言，它支持 tslib 单点输入，tslib 是一个第三方库，对电阻屏这类低精度屏而言表现较为优秀；而 evdev 则是 Qt 自带输入库，支持多点输入，但是对于电阻这类需要校准的屏幕效果不好，适合电容这类屏幕

## 下载编译tslib
```
#!/bin/bash
#自动生成Makefile
./autogen.sh    

#设置交叉编译器的地址
#设置安装目录
#设置目标平台类型
./configure \
CC=/opt/hisi-linux/x86-arm/arm-himix200-linux/bin/arm-himix200-linux-gcc \
CXX=/opt/hisi-linux/x86-arm/arm-himix200-linux/bin/arm-himix200-linux-g++ \
--prefix=/opt/tslib122 \
--host=arm-linux-gnueabi \
--cache-file=arm-linux-gnueabi.cache \
--enable-input ac_cv_func_malloc_0_nonnull=yes

#编译
sudo make -j4

#安装
sudo make install
```
## 编译tslib报错
autoreconf: not found
安装以下软件
```
sudo apt-get install autoconf automake libtool
```

## 打包/opt/tslib122发布到开发板配置环境变量
```
export TSLIB_DIR=/opt/ipnc/app/tslib122
export TSLIB_TSDEVICE=/dev/input/event1
export TSLIB_CALIBFILE=/opt/ipnc/app/tslib122/etc/pointercal
export TSLIB_CONFFILE=/opt/ipnc/app/tslib122/etc/ts.conf
export TSLIB_PLUGINDIR=/opt/ipnc/app/tslib122/lib/ts
export TSLIB_CONSOLEDEVICE=none
export TSLIB_FBDEVICE=/dev/fb0
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$TSLIB_DIR/lib
export QT_QPA_FB_TSLIB=1
```

### Qt添加对tslib的支持
```
-tslib \
-I/opt/tslib/include \
-L/opt/tslib/lib \
-recheck-all
```
### 编译qt源码带tslib时报错
ERROR: Feature 'tslib' was enabled, but the pre-condition 'libs.tslib' failed.
如果你的交叉编译工具链为arm-linux-gnueabi，那么你编译tslib时，配置的时候注意./configure --host=arm-linux-gnueabi而不是arm-linux。
tslib要预先编译并指定路径或者配置末尾加上-recheck-all选项。


## 编译Qt配置文件
```conf
qt-everywhere-src-5.12.9/qtbase/mkspecs/linux-arm-himix200-linux-g++/qmake.conf
#
# qmake configuration for building with arm-himix200-linux
#

MAKEFILE_GENERATOR      = UNIX
CONFIG                 += incremental
QMAKE_INCREMENTAL_STYLE = sublib

include(../common/linux.conf)
include(../common/gcc-base-unix.conf)
include(../common/g++-unix.conf)

# modifications to g++.conf
QMAKE_CC                = /opt/hisi-linux/x86-arm/arm-himix200-linux/bin/arm-himix200-linux-gcc
QMAKE_CXX               = /opt/hisi-linux/x86-arm/arm-himix200-linux/bin/arm-himix200-linux-g++
QMAKE_LINK              = /opt/hisi-linux/x86-arm/arm-himix200-linux/bin/arm-himix200-linux-g++
QMAKE_LINK_SHLIB        = /opt/hisi-linux/x86-arm/arm-himix200-linux/bin/arm-himix200-linux-g++

# modifications to linux.conf
QMAKE_AR                = /opt/hisi-linux/x86-arm/arm-himix200-linux/bin/arm-himix200-linux-ar cqs
QMAKE_OBJCOPY           = /opt/hisi-linux/x86-arm/arm-himix200-linux/bin/arm-himix200-linux-objcopy
QMAKE_STRIP             = /opt/hisi-linux/x86-arm/arm-himix200-linux/bin/arm-himix200-linux-strip

load(qt_config)

# modifications to gcc-base.conf
QMAKE_CFLAGS_RELEASE += -mcpu=cortex-a7 -mfloat-abi=softfp -mfpu=neon-vfpv4 -fno-aggressive-loop-optimizations
QMAKE_CXXFLAGS_RELEASE +=-mcpu=cortex-a7 -mfloat-abi=softfp -mfpu=neon-vfpv4 -fno-aggressive-loop-optimizations
```

## 编译Qt脚本
```
#!/bin/bash
./../qt-everywhere-src-5.12.9/configure \
-prefix /opt/qt-5129-3516-dv300-notslib \
-xplatform linux-arm-himix200-linux-g++ \
-v -opensource -confirm-license -release -silent -strip \
-no-rpath \
-no-pch \
-no-pkg-config \
-no-iconv \
-no-openssl \
-no-opengl \
-make libs \
-nomake examples \
-nomake tests \
-nomake tools \
-linuxfb \
-qt-zlib \
-qt-pcre \
-qt-freetype \
-qt-libpng \
-qt-libjpeg \
-qt-sqlite \
-skip qt3d \
-skip qtactiveqt \
-skip qtandroidextras \
-skip qtcanvas3d \
-skip qtcharts \
-skip qtdatavis3d \
-skip qtdoc \
-skip qtgamepad \
-skip qtlocation \
-skip qtmacextras \
-skip qtwebchannel \
-skip qtwebengine \
-skip qtwebglplugin \
-skip qtwebsockets \
-skip qtwebview \
-skip qtserialbus \
-skip qtx11extras 

#sudo make -j4

#sudo make install
```

## 脚本说明
```
skip ： ls 可以看到的文件
nomake ：看 ./configure --help 说明，跟在 nomake 后面有写清楚的
-no-xx：不想用的都可以加这个， ./configure --help 后面会标注 [yes] [no] 之类的
-qt-x： ./configure --help 后面会标注 [qt] 之类的 跟 -no-xx 类似
```

## 屏幕旋转的问题
采用修改linuxfb源码的方式实现旋转,缺陷是切换画面会卡顿
采用tslib校准,触摸点位偏位,坐标越大偏位越严重
不采用tslib校准,触摸点位y轴最大只到606

采用QGraphicsView方式在应用层实现旋转,缺陷是触摸点位异常,系统键盘无法旋转
采用tslib校准,触摸超过1080的点位之后无效
不采用tslib校准,触摸按键最大到1080,1080

## 海思图形层调试信息
cat /proc/umap/hifb0 

## 检测触摸点位
hexdump /dev/input/event1
读取到的坐标值与QMouseEvent的值不对应，原因1是因为屏幕限定宽高是1080x1920，而坐标给出来的是1920x1080


## Qt5与Qt4关于窗口的区别
### QPA

QPA即Qt Platform Abstraction，是Qt5里面的平台抽象层，用以取代Qt for Embedded Linux以及Qt4中的平台接口。
QPA插件通过定义QPlatform开头的一系列类的子类实现，其中有两个根类，QPlatformIntegration和QPlatformTheme，前者用于窗口系统的集成，后者用于更深层次的平台主题化和集成。

Qt4的程序在嵌入式Linux运行时，需要加入参数“-qws”启动Qt窗口系统服务，
如“./app -qws”运行app程序。从Qt5.0开始，Qt自身不再单独实现窗口系统，QWS不复存在，取而代之的新机制是QPA（Qt平台抽象），QPA使得Qt对不同平台的支持变得更加灵活，当需要支持一个新平台时，只需为该平台编写一个QPA插件。

Qt5使用QPA替换Qt4的QWS，单进程跑GUI程序时QPA是个很好的选择，如果是多进程，则使用Wayland。
在嵌入式Linux系统中，有许多平台插件，如EGLFS、LinuxFB、DirectFB、XCB、Wayland，具体使用哪一个，可通过配置选择，
在许多板子上默认选择了eglfs，选择其它插件时可设置QT_QPA_PLATFORM环境变量或-platform命令行参数。
编译源码时，需要选择或修改qtbase/mkspecs/devices目录下设备相关的编译配置文件，包括toolchain和sysroot，
如果是硬件加速相关的，还需要硬件供应商特定的EGL和OpenGL ES代码，不过对于LinuxFB这种只进行软描画的情况来说是不需要硬件加速的，所谓的硬件加速就是通过GPU分担CPU的图形计算工作。

这里我只介绍一个，因为我只用过这一个，LinuxFB通过Linux的fb设备节点，直接向Framebuffer写数据，只支持软描画，有些情况下显示性能会有所限制。
在Qt5.9中，支持DRM dumb buffer，以取代Linux内核弃用的fb，通过DRM API进行描画，类似于eglfs_kms对eglfs的支持，提供了双缓冲、页面跳转以及vsync信号。

### QWS

QWS(Qt Windows System)是QT自行开发的窗口系统，体系结构类似X Windows，是一个C/S结构，由QWS Server在物理设备上显示，由QWS Client实现界面，两者通过socket进行彼此的通讯。在很多嵌入式系统里，QT程序基本上都是用QWS来实现，这样保证程序的可移植性。另外在运行QT程序时添加-qws参数，表示这个程序时QWS Server，否则是QWS Client。任何一个基于QT的application都可以做QWS Server。当然QWS Server一定先于QWS Client启动，否则QWS Client将启动失败。在实际应用中一般会指定某个特殊的application做QWS Server，这个application一般还会管理一些其它的系统资源。

QWS Server管理机制：QWS Server是一个server socket，QWS Client是一个client socket。QWS Client启动时会主动向QWS Server的server socket建立连接。而后就QWS Server通过这个socket传递QWS Command和QWS Event来管理QWS Client。


### 海思himix200交叉编译Qt4.8.7
```
../qt-everywhere-opensource-src-4.8.7/configure --help
Usage:  configure [-h] [-prefix <dir>] [-prefix-install] [-bindir <dir>] [-libdir <dir>]
        [-docdir <dir>] [-headerdir <dir>] [-plugindir <dir> ] [-importdir <dir>] [-datadir <dir>]
        [-translationdir <dir>] [-sysconfdir <dir>] [-examplesdir <dir>]
        [-demosdir <dir>] [-buildkey <key>] [-release] [-debug]
        [-debug-and-release] [-developer-build] [-shared] [-static] [-no-fast] [-fast] [-no-largefile]
        [-largefile] [-no-exceptions] [-exceptions] [-no-accessibility]
        [-accessibility] [-no-stl] [-stl] [-no-sql-<driver>] [-sql-<driver>]
        [-plugin-sql-<driver>] [-system-sqlite] [-no-qt3support] [-qt3support]
        [-platform] [-D <string>] [-I <string>] [-L <string>] [-help]
        [-qt-zlib] [-system-zlib] [-no-gif] [-no-libtiff] [-qt-libtiff] [-system-libtiff]
        [-no-libpng] [-qt-libpng] [-system-libpng] [-no-libmng] [-qt-libmng]
        [-system-libmng] [-no-libjpeg] [-qt-libjpeg] [-system-libjpeg] [-make <part>]
        [-nomake <part>] [-R <string>]  [-l <string>] [-no-rpath]  [-rpath] [-continue]
        [-verbose] [-v] [-silent] [-no-nis] [-nis] [-no-cups] [-cups] [-no-iconv]
        [-iconv] [-no-pch] [-pch] [-no-dbus] [-dbus] [-dbus-linked] [-no-gui]
        [-no-separate-debug-info] [-no-mmx] [-no-3dnow] [-no-sse] [-no-sse2]
        [-no-sse3] [-no-ssse3] [-no-sse4.1] [-no-sse4.2] [-no-avx] [-no-neon]
        [-qtnamespace <namespace>] [-qtlibinfix <infix>] [-separate-debug-info] [-armfpa]
        [-no-optimized-qmake] [-optimized-qmake] [-no-xmlpatterns] [-xmlpatterns]
        [-no-multimedia] [-multimedia] [-no-phonon] [-phonon] [-no-phonon-backend] [-phonon-backend]
        [-no-media-backend] [-media-backend] [-no-audio-backend] [-audio-backend]
        [-no-openssl] [-openssl] [-openssl-linked]
        [-no-gtkstyle] [-gtkstyle] [-no-svg] [-svg] [-no-webkit] [-webkit] [-webkit-debug]
        [-no-javascript-jit] [-javascript-jit]
        [-no-script] [-script] [-no-scripttools] [-scripttools]
        [-no-declarative] [-declarative] [-no-declarative-debug] [-declarative-debug]
        [additional platform specific options (see below)]


Installation options:

    -qpa [name] ......... This will enable the QPA build.
                          QPA is a window system agnostic implementation of Qt.
                          If [name] is given, sets the default QPA platform (e.g xcb, cocoa).

 These are optional, but you may specify install directories.

    -prefix <dir> ...... This will install everything relative to <dir>
                         (default /usr/local/Trolltech/Qt-4.8.7)

  * -prefix-install .... Force a sandboxed "local" installation of
                         Qt. This will install into
                         /usr/local/Trolltech/Qt-4.8.7, if this option is
                         disabled then some platforms will attempt a
                         "system" install by placing default values
                         in a system location other than PREFIX.

 You may use these to separate different parts of the install:

    -bindir <dir> ......... Executables will be installed to <dir>
                            (default PREFIX/bin)
    -libdir <dir> ......... Libraries will be installed to <dir>
                            (default PREFIX/lib)
    -docdir <dir> ......... Documentation will be installed to <dir>
                            (default PREFIX/doc)
    -headerdir <dir> ...... Headers will be installed to <dir>
                            (default PREFIX/include)
    -plugindir <dir> ...... Plugins will be installed to <dir>
                            (default PREFIX/plugins)
    -importdir <dir> ...... Imports for QML will be installed to <dir>
                            (default PREFIX/imports)
    -datadir <dir> ........ Data used by Qt programs will be installed to <dir>
                            (default PREFIX)
    -translationdir <dir> . Translations of Qt programs will be installed to <dir>
                            (default PREFIX/translations)
    -sysconfdir <dir> ..... Settings used by Qt programs will be looked for in <dir>
                            (default PREFIX/etc/settings)
    -examplesdir <dir> .... Examples will be installed to <dir>
                            (default PREFIX/examples)
    -demosdir <dir> ....... Demos will be installed to <dir>
                            (default PREFIX/demos)

 You may use these options to turn on strict plugin loading.

    -buildkey <key> .... Build the Qt library and plugins using the specified
                         <key>.  When the library loads plugins, it will only
                         load those that have a matching key.

Configure options:

 The defaults (*) are usually acceptable. A plus (+) denotes a default value
 that needs to be evaluated. If the evaluation succeeds, the feature is
 included. Here is a short explanation of each option:

 *  -release ........... Compile and link Qt with debugging turned off.
    -debug ............. Compile and link Qt with debugging turned on.
    -debug-and-release . Compile and link two versions of Qt, with and without
                         debugging turned on (Mac only).

    -developer-build ... Compile and link Qt with Qt developer options (including auto-tests exporting)

    -opensource ........ Compile and link the Open-Source Edition of Qt.
    -commercial ........ Compile and link the Commercial Edition of Qt.


 *  -shared ............ Create and use shared Qt libraries.
    -static ............ Create and use static Qt libraries.

 *  -no-fast ........... Configure Qt normally by generating Makefiles for all
                         project files.
    -fast .............. Configure Qt quickly by generating Makefiles only for
                         library and subdirectory targets.  All other Makefiles
                         are created as wrappers, which will in turn run qmake.

    -no-largefile ...... Disables large file support.
 +  -largefile ......... Enables Qt to access files larger than 4 GB.

 *  -no-system-proxies . Do not use system network proxies by default.
    -system-proxies .... Use system network proxies by default.

    -no-exceptions ..... Disable exceptions on compilers that support it.
 *  -exceptions ........ Enable exceptions on compilers that support it.

    -no-accessibility .. Do not compile Accessibility support.
 *  -accessibility ..... Compile Accessibility support.

    -no-stl ............ Do not compile STL support.
 *  -stl ............... Compile STL support.

    -no-sql-<driver> ... Disable SQL <driver> entirely.
    -qt-sql-<driver> ... Enable a SQL <driver> in the QtSql library, by default
                         none are turned on.
    -plugin-sql-<driver> Enable SQL <driver> as a plugin to be linked to
                         at run time.

                         Possible values for <driver>:
                         [  db2 ibase mysql oci odbc psql sqlite sqlite2 sqlite_symbian symsql tds ]

    -system-sqlite ..... Use sqlite from the operating system.

    -no-qt3support ..... Disables the Qt 3 support functionality.
 *  -qt3support ........ Enables the Qt 3 support functionality.

    -no-xmlpatterns .... Do not build the QtXmlPatterns module.
 +  -xmlpatterns ....... Build the QtXmlPatterns module.
                         QtXmlPatterns is built if a decent C++ compiler
                         is used and exceptions are enabled.

    -no-multimedia ..... Do not build the QtMultimedia module.
 +  -multimedia ........ Build the QtMultimedia module.

    -no-audio-backend .. Do not build the platform audio backend into QtMultimedia.
 +  -audio-backend ..... Build the platform audio backend into QtMultimedia if available.

    -no-phonon ......... Do not build the Phonon module.
 +  -phonon ............ Build the Phonon module.
                         Phonon is built if a decent C++ compiler is used.
    -no-phonon-backend.. Do not build the platform phonon plugin.
 +  -phonon-backend..... Build the platform phonon plugin.

    -no-svg ............ Do not build the SVG module.
 +  -svg ............... Build the SVG module.

    -no-webkit ......... Do not build the WebKit module.
 +  -webkit ............ Build the WebKit module.
                         WebKit is built if a decent C++ compiler is used.
    -webkit-debug ...... Build the WebKit module with debug symbols.

    -no-javascript-jit . Do not build the JavaScriptCore JIT compiler.
 +  -javascript-jit .... Build the JavaScriptCore JIT compiler.

    -no-script ......... Do not build the QtScript module.
 +  -script ............ Build the QtScript module.

    -no-scripttools .... Do not build the QtScriptTools module.
 +  -scripttools ....... Build the QtScriptTools module.

    -no-declarative ..... Do not build the declarative module.
 +  -declarative ....... Build the declarative module.

    -no-declarative-debug ..... Do not build the declarative debugging support.
 +  -declarative-debug ....... Build the declarative debugging support.

    -platform target ... The operating system and compiler you are building
                         on (linux-g++).

                         See the README file for a list of supported
                         operating systems and compilers.
    -graphicssystem <sys> Sets an alternate graphics system. Available options are:
                           raster - Software rasterizer
                           opengl - Rendering via OpenGL, Experimental!
                           openvg - Rendering via OpenVG, Experimental!


    -no-mmx ............ Do not compile with use of MMX instructions.
    -no-3dnow .......... Do not compile with use of 3DNOW instructions.
    -no-sse ............ Do not compile with use of SSE instructions.
    -no-sse2 ........... Do not compile with use of SSE2 instructions.
    -no-sse3 ........... Do not compile with use of SSE3 instructions.
    -no-ssse3 .......... Do not compile with use of SSSE3 instructions.
    -no-sse4.1.......... Do not compile with use of SSE4.1 instructions.
    -no-sse4.2.......... Do not compile with use of SSE4.2 instructions.
    -no-avx ............ Do not compile with use of AVX instructions.
    -no-neon ........... Do not compile with use of NEON instructions.

    -qtnamespace <name>  Wraps all Qt library code in 'namespace <name> {...}'.
    -qtlibinfix <infix>  Renames all libQt*.so to libQt*<infix>.so.

    -D <string> ........ Add an explicit define to the preprocessor.
    -I <string> ........ Add an explicit include path.
    -L <string> ........ Add an explicit library path.

    -help, -h .......... Display this information.

Third Party Libraries:

    -qt-zlib ........... Use the zlib bundled with Qt.
 +  -system-zlib ....... Use zlib from the operating system.
                         See http://www.gzip.org/zlib

    -no-gif ............ Do not compile GIF reading support.

    -no-libtiff ........ Do not compile TIFF support.
    -qt-libtiff ........ Use the libtiff bundled with Qt.
 +  -system-libtiff .... Use libtiff from the operating system.
                         See http://www.libtiff.org

    -no-libpng ......... Do not compile PNG support.
    -qt-libpng ......... Use the libpng bundled with Qt.
 +  -system-libpng ..... Use libpng from the operating system.
                         See http://www.libpng.org/pub/png

    -no-libmng ......... Do not compile MNG support.
    -qt-libmng ......... Use the libmng bundled with Qt.
 +  -system-libmng ..... Use libmng from the operating system.
                         See http://www.libmng.com

    -no-libjpeg ........ Do not compile JPEG support.
    -qt-libjpeg ........ Use the libjpeg bundled with Qt.
 +  -system-libjpeg .... Use libjpeg from the operating system.
                         See http://www.ijg.org

    -no-openssl ........ Do not compile support for OpenSSL.
 +  -openssl ........... Enable run-time OpenSSL support.
    -openssl-linked .... Enabled linked OpenSSL support.

    -ptmalloc .......... Override the system memory allocator with ptmalloc.
                         (Experimental.)

Additional options:

    -make <part> ....... Add part to the list of parts to be built at make time.
                         (libs tools examples demos docs translations)
    -nomake <part> ..... Exclude part from the list of parts to be built.

    -R <string> ........ Add an explicit runtime library path to the Qt
                         libraries.
    -l <string> ........ Add an explicit library.

    -no-rpath .......... Do not use the library install path as a runtime
                         library path.
 +  -rpath ............. Link Qt libraries and executables using the library
                         install path as a runtime library path. Equivalent
                         to -R install_libpath

    -continue .......... Continue as far as possible if an error occurs.

    -verbose, -v ....... Print verbose information about each step of the
                         configure process.

    -silent ............ Reduce the build output so that warnings and errors
                         can be seen more easily.

 *  -no-optimized-qmake ... Do not build qmake optimized.
    -optimized-qmake ...... Build qmake optimized.

    -no-gui ............ Don't build the Qt GUI library

    -no-nis ............ Do not compile NIS support.
 *  -nis ............... Compile NIS support.

    -no-cups ........... Do not compile CUPS support.
 *  -cups .............. Compile CUPS support.
                         Requires cups/cups.h and libcups.so.2.

    -no-iconv .......... Do not compile support for iconv(3).
 *  -iconv ............. Compile support for iconv(3).

    -no-pch ............ Do not use precompiled header support.
 *  -pch ............... Use precompiled header support.

    -no-dbus ........... Do not compile the QtDBus module.
 +  -dbus .............. Compile the QtDBus module and dynamically load libdbus-1.
    -dbus-linked ....... Compile the QtDBus module and link to libdbus-1.

    -reduce-relocations ..... Reduce relocations in the libraries through extra
                              linker optimizations (Qt/X11 and Qt for Embedded Linux only;
                              experimental; needs GNU ld >= 2.18).

 *  -no-separate-debug-info . Do not store debug information in a separate file.
    -separate-debug-info .... Strip debug information into a separate file.


Qt/X11 only:

    -no-gtkstyle ....... Do not build the GTK theme integration.
 +  -gtkstyle .......... Build the GTK theme integration.

 *  -no-nas-sound ...... Do not compile in NAS sound support.
    -system-nas-sound .. Use NAS libaudio from the operating system.
                         See http://radscan.com/nas.html

    -egl ............... Use EGL instead of GLX to manage contexts.
                         When building for desktop OpenGL, this option will
                         make Qt use EGL to manage contexts rather than the
                         GLX, which is the default. Note: For OpenGL ES, EGL
                         is always used.

    -no-opengl ......... Do not support OpenGL.
 +  -opengl <api> ...... Enable OpenGL support.
                         With no parameter, this will auto-detect the "best"
                         OpenGL API to use. If desktop OpenGL is available, it
                         will be used. Use desktop, es1, or es2 for <api>
                         to force the use of the Desktop (OpenGL 1.x or 2.x),
                         OpenGL ES 1.x Common profile, or 2.x APIs instead.

     -no-openvg ........ Do not support OpenVG.
 +   -openvg ........... Enable OpenVG support.
                         Requires EGL support, typically supplied by an OpenGL
                         or other graphics implementation.

    -no-sm ............. Do not support X Session Management.
 *  -sm ................ Support X Session Management, links in -lSM -lICE.

    -no-xshape ......... Do not compile XShape support.
 *  -xshape ............ Compile XShape support.
                         Requires X11/extensions/shape.h.

    -no-xvideo ......... Do not compile XVideo support.
 *  -xvideo ............ Compile XVideo support.
                         Requires X11/extensions/Xv.h & Xvlib.h.

    -no-xsync .......... Do not compile XSync support.
 *  -xsync ............. Compile XSync support.
                         Requires X11/extensions/sync.h.

    -no-xinerama ....... Do not compile Xinerama (multihead) support.
 *  -xinerama .......... Compile Xinerama support.
                         Requires X11/extensions/Xinerama.h and libXinerama.
                         By default, Xinerama support will be compiled if
                         available and the shared libraries are dynamically
                         loaded at runtime.

    -no-xcursor ........ Do not compile Xcursor support.
 *  -xcursor ........... Compile Xcursor support.
                         Requires X11/Xcursor/Xcursor.h and libXcursor.
                         By default, Xcursor support will be compiled if
                         available and the shared libraries are dynamically
                         loaded at runtime.

    -no-xfixes ......... Do not compile Xfixes support.
 *  -xfixes ............ Compile Xfixes support.
                         Requires X11/extensions/Xfixes.h and libXfixes.
                         By default, Xfixes support will be compiled if
                         available and the shared libraries are dynamically
                         loaded at runtime.

    -no-xrandr ......... Do not compile Xrandr (resize and rotate) support.
 *  -xrandr ............ Compile Xrandr support.
                         Requires X11/extensions/Xrandr.h and libXrandr.

    -no-xrender ........ Do not compile Xrender support.
 *  -xrender ........... Compile Xrender support.
                         Requires X11/extensions/Xrender.h and libXrender.

    -no-mitshm ......... Do not compile MIT-SHM support.
 *  -mitshm ............ Compile MIT-SHM support.
                         Requires sys/ipc.h, sys/shm.h and X11/extensions/XShm.h

    -no-fontconfig ..... Do not compile FontConfig (anti-aliased font) support.
 *  -fontconfig ........ Compile FontConfig support.
                         Requires fontconfig/fontconfig.h, libfontconfig,
                         freetype.h and libfreetype.

    -no-xinput ......... Do not compile Xinput support.
 *  -xinput ............ Compile Xinput support. This also enabled tablet support
                         which requires IRIX with wacom.h and libXi or
                         XFree86 with X11/extensions/XInput.h and libXi.

    -no-xkb ............ Do not compile XKB (X KeyBoard extension) support.
 *  -xkb ............... Compile XKB support.

    -no-glib ........... Do not compile Glib support.
 +  -glib .............. Compile Glib support. 
```

```
../qt-everywhere-opensource-src-4.8.7/configure -embedded -help
Usage:  configure [-h] [-prefix <dir>] [-prefix-install] [-bindir <dir>] [-libdir <dir>]
        [-docdir <dir>] [-headerdir <dir>] [-plugindir <dir> ] [-importdir <dir>] [-datadir <dir>]
        [-translationdir <dir>] [-sysconfdir <dir>] [-examplesdir <dir>]
        [-demosdir <dir>] [-buildkey <key>] [-release] [-debug]
        [-debug-and-release] [-developer-build] [-shared] [-static] [-no-fast] [-fast] [-no-largefile]
        [-largefile] [-no-exceptions] [-exceptions] [-no-accessibility]
        [-accessibility] [-no-stl] [-stl] [-no-sql-<driver>] [-sql-<driver>]
        [-plugin-sql-<driver>] [-system-sqlite] [-no-qt3support] [-qt3support]
        [-platform] [-D <string>] [-I <string>] [-L <string>] [-help]
        [-qt-zlib] [-system-zlib] [-no-gif] [-no-libtiff] [-qt-libtiff] [-system-libtiff]
        [-no-libpng] [-qt-libpng] [-system-libpng] [-no-libmng] [-qt-libmng]
        [-system-libmng] [-no-libjpeg] [-qt-libjpeg] [-system-libjpeg] [-make <part>]
        [-nomake <part>] [-R <string>]  [-l <string>] [-no-rpath]  [-rpath] [-continue]
        [-verbose] [-v] [-silent] [-no-nis] [-nis] [-no-cups] [-cups] [-no-iconv]
        [-iconv] [-no-pch] [-pch] [-no-dbus] [-dbus] [-dbus-linked] [-no-gui]
        [-no-separate-debug-info] [-no-mmx] [-no-3dnow] [-no-sse] [-no-sse2]
        [-no-sse3] [-no-ssse3] [-no-sse4.1] [-no-sse4.2] [-no-avx] [-no-neon]
        [-qtnamespace <namespace>] [-qtlibinfix <infix>] [-separate-debug-info] [-armfpa]
        [-no-optimized-qmake] [-optimized-qmake] [-no-xmlpatterns] [-xmlpatterns]
        [-no-multimedia] [-multimedia] [-no-phonon] [-phonon] [-no-phonon-backend] [-phonon-backend]
        [-no-media-backend] [-media-backend] [-no-audio-backend] [-audio-backend]
        [-no-openssl] [-openssl] [-openssl-linked]
        [-no-gtkstyle] [-gtkstyle] [-no-svg] [-svg] [-no-webkit] [-webkit] [-webkit-debug]
        [-no-javascript-jit] [-javascript-jit]
        [-no-script] [-script] [-no-scripttools] [-scripttools]
        [-no-declarative] [-declarative] [-no-declarative-debug] [-declarative-debug]
        [additional platform specific options (see below)]


Installation options:

    -qpa [name] ......... This will enable the QPA build.
                          QPA is a window system agnostic implementation of Qt.
                          If [name] is given, sets the default QPA platform (e.g xcb, cocoa).

 These are optional, but you may specify install directories.

    -prefix <dir> ...... This will install everything relative to <dir>
                         (default /usr/local/Trolltech/QtEmbedded-4.8.7)

    -hostprefix [dir] .. Tools and libraries needed when developing
                         applications are installed in [dir]. If [dir] is
                         not given, the current build directory will be used.

  * -prefix-install .... Force a sandboxed "local" installation of
                         Qt. This will install into
                         /usr/local/Trolltech/QtEmbedded-4.8.7, if this option is
                         disabled then some platforms will attempt a
                         "system" install by placing default values
                         in a system location other than PREFIX.

 You may use these to separate different parts of the install:

    -bindir <dir> ......... Executables will be installed to <dir>
                            (default PREFIX/bin)
    -libdir <dir> ......... Libraries will be installed to <dir>
                            (default PREFIX/lib)
    -docdir <dir> ......... Documentation will be installed to <dir>
                            (default PREFIX/doc)
    -headerdir <dir> ...... Headers will be installed to <dir>
                            (default PREFIX/include)
    -plugindir <dir> ...... Plugins will be installed to <dir>
                            (default PREFIX/plugins)
    -importdir <dir> ...... Imports for QML will be installed to <dir>
                            (default PREFIX/imports)
    -datadir <dir> ........ Data used by Qt programs will be installed to <dir>
                            (default PREFIX)
    -translationdir <dir> . Translations of Qt programs will be installed to <dir>
                            (default PREFIX/translations)
    -sysconfdir <dir> ..... Settings used by Qt programs will be looked for in <dir>
                            (default PREFIX/etc/settings)
    -examplesdir <dir> .... Examples will be installed to <dir>
                            (default PREFIX/examples)
    -demosdir <dir> ....... Demos will be installed to <dir>
                            (default PREFIX/demos)

 You may use these options to turn on strict plugin loading.

    -buildkey <key> .... Build the Qt library and plugins using the specified
                         <key>.  When the library loads plugins, it will only
                         load those that have a matching key.

Configure options:

 The defaults (*) are usually acceptable. A plus (+) denotes a default value
 that needs to be evaluated. If the evaluation succeeds, the feature is
 included. Here is a short explanation of each option:

 *  -release ........... Compile and link Qt with debugging turned off.
    -debug ............. Compile and link Qt with debugging turned on.
    -debug-and-release . Compile and link two versions of Qt, with and without
                         debugging turned on (Mac only).

    -developer-build ... Compile and link Qt with Qt developer options (including auto-tests exporting)

    -opensource ........ Compile and link the Open-Source Edition of Qt.
    -commercial ........ Compile and link the Commercial Edition of Qt.


 *  -shared ............ Create and use shared Qt libraries.
    -static ............ Create and use static Qt libraries.

 *  -no-fast ........... Configure Qt normally by generating Makefiles for all
                         project files.
    -fast .............. Configure Qt quickly by generating Makefiles only for
                         library and subdirectory targets.  All other Makefiles
                         are created as wrappers, which will in turn run qmake.

    -no-largefile ...... Disables large file support.
 +  -largefile ......... Enables Qt to access files larger than 4 GB.

 *  -no-system-proxies . Do not use system network proxies by default.
    -system-proxies .... Use system network proxies by default.

 *  -no-exceptions ..... Disable exceptions on compilers that support it.
    -exceptions ........ Enable exceptions on compilers that support it.

    -no-accessibility .. Do not compile Accessibility support.
 *  -accessibility ..... Compile Accessibility support.

    -no-stl ............ Do not compile STL support.
 *  -stl ............... Compile STL support.

    -no-sql-<driver> ... Disable SQL <driver> entirely.
    -qt-sql-<driver> ... Enable a SQL <driver> in the QtSql library, by default
                         none are turned on.
    -plugin-sql-<driver> Enable SQL <driver> as a plugin to be linked to
                         at run time.

                         Possible values for <driver>:
                         [  db2 ibase mysql oci odbc psql sqlite sqlite2 sqlite_symbian symsql tds ]

    -system-sqlite ..... Use sqlite from the operating system.

    -no-qt3support ..... Disables the Qt 3 support functionality.
 *  -qt3support ........ Enables the Qt 3 support functionality.

    -no-xmlpatterns .... Do not build the QtXmlPatterns module.
 +  -xmlpatterns ....... Build the QtXmlPatterns module.
                         QtXmlPatterns is built if a decent C++ compiler
                         is used and exceptions are enabled.

    -no-multimedia ..... Do not build the QtMultimedia module.
 +  -multimedia ........ Build the QtMultimedia module.

    -no-audio-backend .. Do not build the platform audio backend into QtMultimedia.
 +  -audio-backend ..... Build the platform audio backend into QtMultimedia if available.

    -no-phonon ......... Do not build the Phonon module.
 +  -phonon ............ Build the Phonon module.
                         Phonon is built if a decent C++ compiler is used.
    -no-phonon-backend.. Do not build the platform phonon plugin.
 +  -phonon-backend..... Build the platform phonon plugin.

    -no-svg ............ Do not build the SVG module.
 +  -svg ............... Build the SVG module.

    -no-webkit ......... Do not build the WebKit module.
 +  -webkit ............ Build the WebKit module.
                         WebKit is built if a decent C++ compiler is used.
    -webkit-debug ...... Build the WebKit module with debug symbols.

    -no-javascript-jit . Do not build the JavaScriptCore JIT compiler.
 +  -javascript-jit .... Build the JavaScriptCore JIT compiler.

    -no-script ......... Do not build the QtScript module.
 +  -script ............ Build the QtScript module.

    -no-scripttools .... Do not build the QtScriptTools module.
 +  -scripttools ....... Build the QtScriptTools module.

    -no-declarative ..... Do not build the declarative module.
 +  -declarative ....... Build the declarative module.

    -no-declarative-debug ..... Do not build the declarative debugging support.
 +  -declarative-debug ....... Build the declarative debugging support.

    -platform target ... The operating system and compiler you are building
                         on (qws/linux-x86_64-g++).

                         See the README file for a list of supported
                         operating systems and compilers.

    -no-mmx ............ Do not compile with use of MMX instructions.
    -no-3dnow .......... Do not compile with use of 3DNOW instructions.
    -no-sse ............ Do not compile with use of SSE instructions.
    -no-sse2 ........... Do not compile with use of SSE2 instructions.
    -no-sse3 ........... Do not compile with use of SSE3 instructions.
    -no-ssse3 .......... Do not compile with use of SSSE3 instructions.
    -no-sse4.1.......... Do not compile with use of SSE4.1 instructions.
    -no-sse4.2.......... Do not compile with use of SSE4.2 instructions.
    -no-avx ............ Do not compile with use of AVX instructions.
    -no-neon ........... Do not compile with use of NEON instructions.

    -qtnamespace <name>  Wraps all Qt library code in 'namespace <name> {...}'.
    -qtlibinfix <infix>  Renames all libQt*.so to libQt*<infix>.so.

    -D <string> ........ Add an explicit define to the preprocessor.
    -I <string> ........ Add an explicit include path.
    -L <string> ........ Add an explicit library path.

    -help, -h .......... Display this information.

Third Party Libraries:

    -qt-zlib ........... Use the zlib bundled with Qt.
 +  -system-zlib ....... Use zlib from the operating system.
                         See http://www.gzip.org/zlib

    -no-gif ............ Do not compile GIF reading support.

    -no-libtiff ........ Do not compile TIFF support.
    -qt-libtiff ........ Use the libtiff bundled with Qt.
 +  -system-libtiff .... Use libtiff from the operating system.
                         See http://www.libtiff.org

    -no-libpng ......... Do not compile PNG support.
    -qt-libpng ......... Use the libpng bundled with Qt.
 +  -system-libpng ..... Use libpng from the operating system.
                         See http://www.libpng.org/pub/png

    -no-libmng ......... Do not compile MNG support.
    -qt-libmng ......... Use the libmng bundled with Qt.
 +  -system-libmng ..... Use libmng from the operating system.
                         See http://www.libmng.com

    -no-libjpeg ........ Do not compile JPEG support.
    -qt-libjpeg ........ Use the libjpeg bundled with Qt.
 +  -system-libjpeg .... Use libjpeg from the operating system.
                         See http://www.ijg.org

    -no-openssl ........ Do not compile support for OpenSSL.
 +  -openssl ........... Enable run-time OpenSSL support.
    -openssl-linked .... Enabled linked OpenSSL support.

    -ptmalloc .......... Override the system memory allocator with ptmalloc.
                         (Experimental.)

Additional options:

    -make <part> ....... Add part to the list of parts to be built at make time.
                         (libs tools examples demos docs translations)
    -nomake <part> ..... Exclude part from the list of parts to be built.

    -R <string> ........ Add an explicit runtime library path to the Qt
                         libraries.
    -l <string> ........ Add an explicit library.

    -no-rpath .......... Do not use the library install path as a runtime
                         library path.
 +  -rpath ............. Link Qt libraries and executables using the library
                         install path as a runtime library path. Equivalent
                         to -R install_libpath

    -continue .......... Continue as far as possible if an error occurs.

    -verbose, -v ....... Print verbose information about each step of the
                         configure process.

    -silent ............ Reduce the build output so that warnings and errors
                         can be seen more easily.

 *  -no-optimized-qmake ... Do not build qmake optimized.
    -optimized-qmake ...... Build qmake optimized.

    -no-gui ............ Don't build the Qt GUI library

    -no-nis ............ Do not compile NIS support.
 *  -nis ............... Compile NIS support.

    -no-cups ........... Do not compile CUPS support.
 *  -cups .............. Compile CUPS support.
                         Requires cups/cups.h and libcups.so.2.

    -no-iconv .......... Do not compile support for iconv(3).
 *  -iconv ............. Compile support for iconv(3).

    -no-pch ............ Do not use precompiled header support.
 *  -pch ............... Use precompiled header support.

    -no-dbus ........... Do not compile the QtDBus module.
 +  -dbus .............. Compile the QtDBus module and dynamically load libdbus-1.
    -dbus-linked ....... Compile the QtDBus module and link to libdbus-1.

    -reduce-relocations ..... Reduce relocations in the libraries through extra
                              linker optimizations (Qt/X11 and Qt for Embedded Linux only;
                              experimental; needs GNU ld >= 2.18).

 *  -no-separate-debug-info . Do not store debug information in a separate file.
    -separate-debug-info .... Strip debug information into a separate file.

Qt for Embedded Linux:

    -embedded <arch> .... This will enable the embedded build, you must have a
                          proper license for this switch to work.
                          Example values for <arch>: arm mips x86 generic

    -xplatform target ... The target platform when cross-compiling.

    -device-option <key=value> ... Add device specific options for the device mkspec
                                   (experimental)

    -no-feature-<feature> Do not compile in <feature>.
    -feature-<feature> .. Compile in <feature>. The available features
                          are described in src/corelib/global/qfeatures.txt

    -armfpa ............. Target platform uses the ARM-FPA floating point format.
    -no-armfpa .......... Target platform does not use the ARM-FPA floating point format.

                          The floating point format is usually autodetected by configure. Use this
                          to override the detected value.

    -little-endian ...... Target platform is little endian (LSB first).
    -big-endian ......... Target platform is big endian (MSB first).

    -host-little-endian . Host platform is little endian (LSB first).
    -host-big-endian .... Host platform is big endian (MSB first).

                          You only need to specify the endianness when
                          cross-compiling, otherwise the host
                          endianness will be used.

    -no-freetype ........ Do not compile in Freetype2 support.
    -qt-freetype ........ Use the libfreetype bundled with Qt.
 *  -system-freetype .... Use libfreetype from the operating system.
                          See http://www.freetype.org/

    -qconfig local ...... Use src/corelib/global/qconfig-local.h rather than the
                          default (full).

    -no-opengl .......... Do not support OpenGL.
    -opengl <api> ....... Enable OpenGL ES support
                          With no parameter, this will attempt to auto-detect OpenGL ES 1.x
                          or 2.x, or regular desktop OpenGL.
                          Use es1 or es2 for <api> to override auto-detection.

    -depths <list> ...... Comma-separated list of supported bit-per-pixel
                          depths, from: 1, 4, 8, 12, 15, 16, 18, 24, 32 and 'all'.

    -qt-decoration-<style> ....Enable a decoration <style> in the QtGui library,
                               by default all available decorations are on.
                               Possible values for <style>: [ styled windows default ]
    -plugin-decoration-<style> Enable decoration <style> as a plugin to be
                               linked to at run time.
                               Possible values for <style>: [  default styled windows ]
    -no-decoration-<style> ....Disable decoration <style> entirely.
                               Possible values for <style>: [ styled windows default ]

    -qt-gfx-<driver> ... Enable a graphics <driver> in the QtGui library.
                         Possible values for <driver>: [ linuxfb transformed qvfb vnc multiscreen directfb qnx integrityfb ]
    -plugin-gfx-<driver> Enable graphics <driver> as a plugin to be
                         linked to at run time.
                         Possible values for <driver>: [  ahi directfb eglnullws linuxfb powervr qvfb transformed vnc ]
    -no-gfx-<driver> ... Disable graphics <driver> entirely.
                         Possible values for <driver>: [ linuxfb transformed qvfb vnc multiscreen directfb qnx integrityfb ]

    -qt-kbd-<driver> ... Enable a keyboard <driver> in the QtGui library.
                         Possible values for <driver>: [ tty linuxinput qvfb qnx integrity ]

    -plugin-kbd-<driver> Enable keyboard <driver> as a plugin to be linked to
                         at runtime.
                         Possible values for <driver>: [  linuxinput ]

    -no-kbd-<driver> ... Disable keyboard <driver> entirely.
                         Possible values for <driver>: [ tty linuxinput qvfb qnx integrity ]

    -qt-mouse-<driver> ... Enable a mouse <driver> in the QtGui library.
                           Possible values for <driver>: [ pc linuxtp linuxinput tslib qvfb qnx integrity ]
    -plugin-mouse-<driver> Enable mouse <driver> as a plugin to be linked to
                           at runtime.
                           Possible values for <driver>: [  linuxtp pc tslib ]
    -no-mouse-<driver> ... Disable mouse <driver> entirely.
                           Possible values for <driver>: [ pc linuxtp linuxinput tslib qvfb qnx integrity ]

    -iwmmxt ............ Compile using the iWMMXt instruction set
                         (available on some XScale CPUs).
    -no-glib ........... Do not compile Glib support.
 +  -glib .............. Compile Glib support.
```

```
./configure 
-prefix /opt/qt4.8.7_hi3516dv300 \
-opensource -confirm-license 
-qt-sql-sqlite 
-plugin-sql-sqlite 
-qt-gfx-linuxfb 
-qt-gfx-transformed 
-no-qt3support 
-no-phonon 
-no-svg 
-no-webkit 
-no-script 
-no-scripttools 
-no-declarative 
-no-declarative-debug 
-qt-zlib 
-no-gif 
-no-libtiff 
-qt-libpng 
-no-libmng 
-qt-libjpeg 
-no-rpath 
-no-pch 
-no-3dnow 
-no-avx 
-no-neon 
-no-openssl 
-no-nis 
-no-cups 
-no-dbus 
-embedded arm 
-platform linux-g++ \
-xplatform qws/linux-arm-himix200-linux-g++ \
-little-endian 
-qt-freetype 
-no-opengl 
-no-glib 
-make libs -nomake demos -nomake docs -nomake translations -nomake examples -nomake tests -nomake tools 
```

```
./../qt-everywhere-opensource-src-4.8.7/configure \
-prefix /opt/qt4.8.7_hi3516dv300 \
-prefix-install \
-platform qws/linux-arm-himix200-linux-g++ \
-platform linux-g++ \
-v -opensource -commercial -release -shared -arch arm -embedded arm \
-no-qt3support \
-no-multimedia \
-no-audio-backend \
-no-phonon \
-no-phonon-backend \
-no-svg \
-no-webkit \
-no-javascript-jit \
-no-script \
-no-scripttools \
-no-declarative \
-no-declarative-debug \
-no-openssl \
-no-iconv \
-no-cups \
-no-dbus \
-no-opengl \
-no-libtiff \
-no-libmng \
-make libs -nomake demos -nomake docs -nomake translations -nomake examples -nomake tests -nomake tools \
-qt-zlib \
-qt-libpng \
-qt-libjpeg \
-qt-sql-sqlite \
-plugin-sql-sqlite \
-qt-gfx-transformed \
-qt-gfx-linuxfb
```

## QWSSocket::connectToLocalFile could not connect:: No such file or directory
加上-qws参数后，可以正确启动。

## QScreenLinuxFb::connect: Operation not permitted Error opening framebuffer device /dev/fb0
hifb初始化失败

## QT4和QT5中的截图
//this->m_pixMap = QPixmap::grabWindow(QApplication::desktop()->winId(), 0, 0, -1, -1);
//this->m_pixMap = QWidget::grab(QRect( QPoint( 0, 0 ), QSize( -1, -1 ) ));
QScreen* screen = QGuiApplication::primaryScreen();
this->m_pixMap = screen->grabWindow(QApplication::desktop()->winId(), 0, 0, -1, -1);

使用QWidget::grab再QT5中会有警告 this function is deprecated, use QScreen::grabWindow() instead. Defaulting to primary screen.
使用第二种只截取当前App的界面，非桌面全屏
使用第三种没有警告，且截取的是桌面全屏

## linux嵌入式qt的屏幕旋转与字体大小问题
1. 与qt程序显示文字大小有关的两项
export QWS_DISPLAY=LinuxFB:mmWidth200:mmHeight100:0  //输出设备为Linux framebuffer，尺寸定义（尺寸定义与文字大小有直接关系）
export QWS_SIZE=480x272  //屏幕大小
2. 屏幕旋转
export QWS_DISPLAY=Transformed:Rot90   //旋转90 可以旋转0、90、180、270
想让qt支持旋转，在编译嵌入式qt的时候要加上-qt-gfx-transformed选项
3. 举一反三：在屏幕旋转的同时保持文字大小
export QWS_DISPLAY=Transformed:Rot90:LinuxFB:mmWidth200:mmHeight100:0
4. 用-display参数来代替以上export的变量
假如将运行的程序是qtdemo
qtdemo -qws -display "LinuxFB:mmWidth200:mmHeight100:0"
qtdemo -qws -display "Transformed:Rot90"
qtdemo -qws -display "Transformed:Rot90:LinuxFB:mmWidth200:mmHeight100:0"


## 使用电容屏
1.一定要使能 -qt-mouse-linuxinput，否则无法使用电容屏，同时 -no-mouse-tslib，-no-mouse-linuxtp，-no-mouse-pc，-no-mouse-qvfb，-no-mouse-qnx。
2.如果要使Qt程序可以旋转屏幕，那么还要使能 -qt-gfx-transformed。

启动时环境变量设置：
export QTDIR=/opt/ipnc/app/qt_487_3516
export LD_LIBRARY_PATH=$QTDIR/lib:$LD_LIBRARY_PATH
export QT_QWS_FONTDIR=$QTDIR/lib/fonts
export QT_PLUGIN_PATH=$QTDIR/plugins
export QWS_DISPLAY="Transformed:Rot90"
export QWS_MOUSE_PROTO="LinuxInput:/dev/input/event1"

## Could not read calibration: "/etc/pointercal"
Qt4.8.7自带校准程序进行校准一下生成/etc/pointercal文件
example/qws/mousecalibration
cd qt4.8.7/example/qws/mousecalibration
/opt/qt4.8.7/bin/qmake mousecalibration.pro 生成 Makefile
make

## unkown mouse event type 警告
修改 qt4.8.7/src/gui/embeded/qmouselinuxinput_qws.cpp 源码
```
bool unknown = false;
if (data->type == EV_ABS) {
    if (data->code == ABS_X) {
        m_x = data->value;
    } else if (data->code == ABS_Y) {
        m_y = data->value;
    } else {
        unknown = true;
    }
} else if (data->type == EV_REL) {
    if (data->code == REL_X) {
        m_x += data->value;
    } else if (data->code == REL_Y) {
        m_y += data->value;
    } else {
        unknown = true;
    }
}
```
qmouse linuxinput_qws.cpp,里面读取的坐标数据都是ABS_X, ABS_Y没有带MT的.
```
#define ABS_X            0x00
#define ABS_Y           0x01

unknown mouse event type=3, code=39, value=87
unknown mouse event type=3, code=35, value=21d
unknown mouse event type=3, code=36, value=587
unknown mouse event type=3, code=3a, value=33
unknown mouse event type=3, code=30, value=33

#define ABS_MT_TOUCH_MAJOR  0x30    /* Major axis of touching ellipse */
#define ABS_MT_POSITION_X   0x35    /* Center X ellipse position */
#define ABS_MT_POSITION_Y   0x36    /* Center Y ellipse position */
#define ABS_MT_TRACKING_ID  0x39    /* Unique ID of initiated contact */
#define ABS_MT_PRESSURE     0x3a    /* Pressure on contact area */
```

## 裁剪feature
./src/corelib/global/qfeatures.h

## Qt C++11支持
Qt4版本下仅Qt4.7与Qt4.8支持C++11，在pro文件添加以下代码即可：

QMAKE_CXXFLAGS += -std=c++0x

Qt5版本以上添加以下代码：

CONFIG += C++11


